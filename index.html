<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Logger</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f8fafc; }
        .container { max-width: 400px; margin: 0 auto; background: white; min-height: 100vh; }
        .header { background: linear-gradient(135deg, #1e1b4b, #312e81); color: white; padding: 16px; position: relative; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .title { font-size: 24px; font-weight: bold; cursor: pointer; }
        .subtitle { color: #c7d2fe; margin-top: 4px; }
        .status-indicator { display: flex; align-items: center; gap: 4px; font-size: 12px; color: #c7d2fe; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .online { background: #10b981; }
        .offline { background: #ef4444; }
        .tabs { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 16px; background: #f1f5f9; }
        .tab { background: #e2e8f0; padding: 12px; border-radius: 8px; border: none; cursor: pointer; display: flex; flex-direction: column; align-items: center; }
        .tab.active { background: #4338ca; color: white; }
        .tab-icon { width: 24px; height: 24px; margin-bottom: 4px; }
        .content { padding: 16px; }
        .hours-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; background: #eef2ff; padding: 16px; border-radius: 8px; margin-bottom: 24px; }
        .hours-item h3 { font-size: 12px; color: #6b7280; margin-bottom: 4px; }
        .hours-item p { font-size: 20px; font-weight: bold; color: #4338ca; }
        .form-group { margin-bottom: 16px; }
        .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .form-row-3 { display: grid; grid-template-columns: 1fr 1fr auto; gap: 8px; align-items: end; }
        .time-total { background: #eef2ff; border: 1px solid #d1d5db; border-radius: 8px; padding: 12px; font-size: 14px; font-weight: bold; color: #4338ca; display: flex; align-items: center; justify-content: center; min-width: 60px; }
        label { display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 4px; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #4338ca; box-shadow: 0 0 0 3px rgba(67, 56, 202, 0.1); }
        .btn { background: #4338ca; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%; }
        .btn:hover { background: #3730a3; }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; }
        .btn-danger { background: #dc2626; }
        .btn-danger:hover { background: #b91c1c; }
        .flight-card { background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; }
        .flight-card:hover { border-color: #4338ca; box-shadow: 0 2px 8px rgba(67, 56, 202, 0.1); }
        .calc-display { background: #eef2ff; padding: 16px; border-radius: 8px; margin-bottom: 16px; }
        .calc-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .calc-main { font-size: 18px; font-weight: bold; color: #1e1b4b; }
        .calc-sub { font-size: 14px; color: #4338ca; }
        .hidden { display: none; }
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; border-radius: 12px; padding: 24px; max-width: 90vw; max-height: 90vh; overflow-y: auto; }
        .modal-buttons { display: flex; gap: 12px; margin-top: 20px; }
        .aircraft-editor { background: #f1f5f9; padding: 12px; border-radius: 8px; margin-bottom: 16px; }
        .aircraft-list { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
        .aircraft-chip { background: #4338ca; color: white; padding: 6px 12px; border-radius: 20px; font-size: 14px; cursor: pointer; }
        .aircraft-chip.active { background: #1e1b4b; }
        .datalist-container { position: relative; }
        input[list] { background-image: url('data:image/svg+xml;utf8,<svg fill="%23374151" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>'); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div>
                    <h1 class="title" onclick="showAircraftEditor()" id="current-aircraft">N12345</h1>
                    <p class="subtitle">Flight Logger</p>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="status-dot"></div>
                    <span id="status-text">Online</span>
                </div>
            </div>
        </div>

        <!-- Aircraft Editor Modal -->
        <div id="aircraft-modal" class="modal hidden">
            <div class="modal-content">
                <h3 style="margin-bottom: 16px;">Manage Aircraft</h3>
                <div class="aircraft-list" id="aircraft-list"></div>
                <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                    <input type="text" id="new-aircraft" placeholder="N123AB" style="text-transform: uppercase;">
                    <button onclick="addAircraft()" style="padding: 12px 16px; background: #10b981; color: white; border: none; border-radius: 8px;">Add</button>
                </div>
                <button onclick="closeAircraftEditor()" class="btn">Done</button>
            </div>
        </div>

        <!-- Flight Editor Modal -->
        <div id="flight-modal" class="modal hidden">
            <div class="modal-content">
                <h3 style="margin-bottom: 16px;">Edit Flight</h3>
                <div id="flight-editor-content"></div>
                <div class="modal-buttons">
                    <button onclick="saveFlight()" class="btn">Save Changes</button>
                    <button onclick="deleteFlight()" class="btn btn-danger">Delete Flight</button>
                    <button onclick="closeFlightEditor()" class="btn" style="background: #6b7280;">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('dashboard')">
                <div class="tab-icon">üìä</div>
                <span style="font-size: 12px;">Dashboard</span>
            </button>
            <button class="tab" onclick="showTab('log')">
                <div class="tab-icon">‚ûï</div>
                <span style="font-size: 12px;">Log Flight</span>
            </button>
            <button class="tab" onclick="showTab('flights')">
                <div class="tab-icon">‚úàÔ∏è</div>
                <span style="font-size: 12px;">Flights</span>
            </button>
            <button class="tab" onclick="showTab('maintenance')">
                <div class="tab-icon">üîß</div>
                <span style="font-size: 12px;">Maintenance</span>
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="content">
            <div class="hours-grid">
                <div class="hours-item">
                    <h3>Hobbs Time</h3>
                    <p id="hobbs-display">1249.4</p>
                </div>
                <div class="hours-item">
                    <h3>Total Flight Hours</h3>
                    <p id="total-display">1249.4</p>
                </div>
                <div class="hours-item">
                    <h3>Left Tach</h3>
                    <p id="left-display">1250.5</p>
                </div>
                <div class="hours-item">
                    <h3>Right Tach</h3>
                    <p id="right-display">1248.2</p>
                </div>
            </div>
            
            <h3 style="margin-bottom: 12px; font-size: 18px;">Recent Flights</h3>
            <div id="recent-flights"></div>
        </div>

        <!-- Log Flight Tab -->
        <div id="log" class="content hidden">
            <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 16px;">Log New Flight</h2>
            
            <div class="form-group">
                <label>Date</label>
                <input type="date" id="flight-date">
            </div>

            <div class="form-group">
                <label>Hobbs Time</label>
                <div class="form-row-3">
                    <div>
                        <label>Start</label>
                        <input type="number" step="0.1" id="hobbs-start" placeholder="1249.4" oninput="calculateTimes()">
                    </div>
                    <div>
                        <label>End</label>
                        <input type="number" step="0.1" id="hobbs-end" oninput="calculateTimes()">
                    </div>
                    <div class="time-total" id="hobbs-total">0.0h</div>
                </div>
            </div>

            <div class="form-group">
                <label>Left Tach</label>
                <div class="form-row-3">
                    <div>
                        <label>Start</label>
                        <input type="number" step="0.1" id="left-start" placeholder="1250.5" oninput="calculateTimes()">
                    </div>
                    <div>
                        <label>End</label>
                        <input type="number" step="0.1" id="left-end" oninput="calculateTimes()">
                    </div>
                    <div class="time-total" id="left-total">0.0h</div>
                </div>
            </div>

            <div class="form-group">
                <label>Right Tach</label>
                <div class="form-row-3">
                    <div>
                        <label>Start</label>
                        <input type="number" step="0.1" id="right-start" placeholder="1248.2" oninput="calculateTimes()">
                    </div>
                    <div>
                        <label>End</label>
                        <input type="number" step="0.1" id="right-end" oninput="calculateTimes()">
                    </div>
                    <div class="time-total" id="right-total">0.0h</div>
                </div>
            </div>

            <div class="form-group">
                <label>Total Flight Hours</label>
                <div class="form-row-3">
                    <div>
                        <label>Start</label>
                        <input type="number" step="0.1" id="total-start" placeholder="1249.4" oninput="calculateTimes()">
                    </div>
                    <div>
                        <label>End</label>
                        <input type="number" step="0.1" id="total-end" oninput="calculateTimes()">
                    </div>
                    <div class="time-total" id="total-flight-total">0.0h</div>
                </div>
            </div>

            <div class="form-group">
                <label>Mission Type</label>
                <input list="mission-list" id="mission" value="Personal">
                <datalist id="mission-list">
                    <option value="Personal">
                    <option value="Training">
                    <option value="Business">
                    <option value="Maintenance">
                </datalist>
            </div>

            <div class="form-group">
                <label>Mission Description</label>
                <input list="description-list" type="text" id="mission-desc" placeholder="e.g., Weekend trip to visit family">
                <datalist id="description-list"></datalist>
            </div>

            <div class="form-group">
                <div class="form-row">
                    <div>
                        <label>From</label>
                        <input list="airport-list" type="text" id="from" placeholder="KSAN" style="text-transform: uppercase;">
                        <datalist id="airport-list"></datalist>
                    </div>
                    <div>
                        <label>To</label>
                        <input list="airport-list" type="text" id="to" placeholder="KLAS" style="text-transform: uppercase;">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Remarks</label>
                <input list="remarks-list" id="remarks" placeholder="Weather, notes, etc.">
                <datalist id="remarks-list"></datalist>
            </div>

            <button class="btn" onclick="logFlight()">Log Flight</button>
        </div>

        <!-- Flights Tab -->
        <div id="flights" class="content hidden">
            <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 16px;">Flight History</h2>
            <div id="flight-history"></div>
        </div>

        <!-- Maintenance Tab -->
        <div id="maintenance" class="content hidden">
            <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 16px;">Maintenance Tracking</h2>
            <div class="flight-card">
                <h3 style="font-weight: bold; margin-bottom: 8px;">Oil Change - Left Engine</h3>
                <p style="color: #6b7280; font-size: 14px;">Due at 1300h (49.5h remaining)</p>
            </div>
            <div class="flight-card">
                <h3 style="font-weight: bold; margin-bottom: 8px;">Oil Change - Right Engine</h3>
                <p style="color: #6b7280; font-size: 14px;">Due at 1300h (51.8h remaining)</p>
            </div>
            <div class="flight-card">
                <h3 style="font-weight: bold; margin-bottom: 8px;">Annual Inspection</h3>
                <p style="color: #6b7280; font-size: 14px;">Due 2025-09-15</p>
            </div>
        </div>
    </div>

    <script>
        // Initialize data
        let flights = JSON.parse(localStorage.getItem('flights') || '[]');
        let aircraft = JSON.parse(localStorage.getItem('aircraft') || '{"N12345": {"hobbs": 1249.4, "total": 1249.4, "left": 1250.5, "right": 1248.2}}');
        let currentAircraft = localStorage.getItem('currentAircraft') || 'N12345';
        let editingFlightId = null;
        let isOnline = navigator.onLine;
        let pendingSync = JSON.parse(localStorage.getItem('pendingSync') || 'false');

        // Auto-complete data
        let missionDescriptions = new Set();
        let airports = new Set();
        let remarks = new Set();

        // Initialize
        document.getElementById('flight-date').value = new Date().toISOString().split('T')[0];
        updateOnlineStatus();
        updateAircraftDisplay();
        updateDashboard();
        populateAutocomplete();

        // Online/Offline detection
        window.addEventListener('online', () => {
            isOnline = true;
            updateOnlineStatus();
            syncOfflineData();
        });

        window.addEventListener('offline', () => {
            isOnline = false;
            updateOnlineStatus();
        });

        function updateOnlineStatus() {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            
            if (isOnline) {
                dot.className = 'status-dot online';
                text.textContent = pendingSync ? 'Syncing...' : 'Online';
            } else {
                dot.className = 'status-dot offline';
                text.textContent = 'Offline';
            }
        }

        function syncOfflineData() {
            if (pendingSync && isOnline) {
                // Simulate cloud sync
                setTimeout(() => {
                    pendingSync = false;
                    localStorage.setItem('pendingSync', 'false');
                    updateOnlineStatus();
                    console.log('Data synced to cloud');
                }, 2000);
            }
        }

        function markForSync() {
            pendingSync = true;
            localStorage.setItem('pendingSync', 'true');
            updateOnlineStatus();
            if (isOnline) {
                syncOfflineData();
            }
        }

        function populateAutocomplete() {
            flights.forEach(flight => {
                if (flight.missionDesc) missionDescriptions.add(flight.missionDesc);
                if (flight.from) airports.add(flight.from);
                if (flight.to) airports.add(flight.to);
                if (flight.remarks) remarks.add(flight.remarks);
            });

            updateDatalist('description-list', missionDescriptions);
            updateDatalist('airport-list', airports);
            updateDatalist('remarks-list', remarks);
        }

        function updateDatalist(id, dataSet) {
            const datalist = document.getElementById(id);
            datalist.innerHTML = Array.from(dataSet).map(item => `<option value="${item}">`).join('');
        }

        function showTab(tabName) {
            document.querySelectorAll('.content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabName).classList.remove('hidden');
            event.target.closest('.tab').classList.add('active');
            
            if (tabName === 'flights') {
                displayFlights();
            }
        }

        function calculateTimes() {
            const pairs = [
                ['hobbs-start', 'hobbs-end', 'hobbs-total'],
                ['left-start', 'left-end', 'left-total'],
                ['right-start', 'right-end', 'right-total'],
                ['total-start', 'total-end', 'total-flight-total']
            ];

            pairs.forEach(([startId, endId, totalId]) => {
                const start = parseFloat(document.getElementById(startId).value) || 0;
                const end = parseFloat(document.getElementById(endId).value) || 0;
                const total = end - start;
                
                document.getElementById(totalId).textContent = total > 0 ? `${total.toFixed(1)}h` : '0.0h';
            });
        }

        function showAircraftEditor() {
            const modal = document.getElementById('aircraft-modal');
            const list = document.getElementById('aircraft-list');
            
            list.innerHTML = Object.keys(aircraft).map(tail => 
                `<div class="aircraft-chip ${tail === currentAircraft ? 'active' : ''}" 
                      onclick="selectAircraft('${tail}')">${tail}</div>`
            ).join('');
            
            modal.classList.remove('hidden');
        }

        function closeAircraftEditor() {
            document.getElementById('aircraft-modal').classList.add('hidden');
        }

        function selectAircraft(tailNumber) {
            currentAircraft = tailNumber;
            localStorage.setItem('currentAircraft', currentAircraft);
            updateAircraftDisplay();
            updateDashboard();
            closeAircraftEditor();
        }

        function addAircraft() {
            const input = document.getElementById('new-aircraft');
            const tailNumber = input.value.toUpperCase().trim();
            
            if (tailNumber && !aircraft[tailNumber]) {
                aircraft[tailNumber] = { hobbs: 0, total: 0, left: 0, right: 0 };
                localStorage.setItem('aircraft', JSON.stringify(aircraft));
                input.value = '';
                showAircraftEditor(); // Refresh the list
                markForSync();
            }
        }

        function updateAircraftDisplay() {
            document.getElementById('current-aircraft').textContent = currentAircraft;
        }

        function logFlight() {
            const hobbsStart = parseFloat(document.getElementById('hobbs-start').value);
            const hobbsEnd = parseFloat(document.getElementById('hobbs-end').value);
            
            if (!hobbsStart || !hobbsEnd) {
                alert('Please enter Hobbs start and end times');
                return;
            }

            const flight = {
                id: editingFlightId || Date.now(),
                aircraft: currentAircraft,
                date: document.getElementById('flight-date').value,
                hobbsStart: hobbsStart,
                hobbsEnd: hobbsEnd,
                flightTime: hobbsEnd - hobbsStart,
                leftStart: parseFloat(document.getElementById('left-start').value) || 0,
                leftEnd: parseFloat(document.getElementById('left-end').value) || 0,
                leftTime: (parseFloat(document.getElementById('left-end').value) || 0) - (parseFloat(document.getElementById('left-start').value) || 0),
                rightStart: parseFloat(document.getElementById('right-start').value) || 0,
                rightEnd: parseFloat(document.getElementById('right-end').value) || 0,
                rightTime: (parseFloat(document.getElementById('right-end').value) || 0) - (parseFloat(document.getElementById('right-start').value) || 0),
                totalStart: parseFloat(document.getElementById('total-start').value) || 0,
                totalEnd: parseFloat(document.getElementById('total-end').value) || 0,
                totalTime: (parseFloat(document.getElementById('total-end').value) || 0) - (parseFloat(document.getElementById('total-start').value) || 0),
                mission: document.getElementById('mission').value,
                missionDesc: document.getElementById('mission-desc').value,
                from: document.getElementById('from').value.toUpperCase(),
                to: document.getElementById('to').value.toUpperCase(),
                remarks: document.getElementById('remarks').value
            };

            if (editingFlightId) {
                // Update existing flight
                const index = flights.findIndex(f => f.id === editingFlightId);
                if (index !== -1) {
                    flights[index] = flight;
                }
                editingFlightId = null;
            } else {
                // Add new flight
                flights.unshift(flight);
                
                // Update aircraft totals
                if (!aircraft[currentAircraft]) {
                    aircraft[currentAircraft] = { hobbs: 0, total: 0, left: 0, right: 0 };
                }
                
                aircraft[currentAircraft].hobbs = hobbsEnd;
                aircraft[currentAircraft].total = flight.totalEnd || hobbsEnd;
                aircraft[currentAircraft].left = flight.leftEnd || aircraft[currentAircraft].left;
                aircraft[currentAircraft].right = flight.rightEnd || aircraft[currentAircraft].right;
            }

            // Save data
            localStorage.setItem('flights', JSON.stringify(flights));
            localStorage.setItem('aircraft', JSON.stringify(aircraft));
            markForSync();

            // Update autocomplete data
            if (flight.missionDesc) missionDescriptions.add(flight.missionDesc);
            if (flight.from) airports.add(flight.from);
            if (flight.to) airports.add(flight.to);
            if (flight.remarks) remarks.add(flight.remarks);
            populateAutocomplete();

            updateDashboard();
            
            // Reset form for next flight
            if (!editingFlightId) {
                document.getElementById('hobbs-start').value = hobbsEnd;
                document.getElementById('left-start').value = flight.leftEnd || '';
                document.getElementById('right-start').value = flight.rightEnd || '';
                document.getElementById('total-start').value = flight.totalEnd || '';
                
                ['hobbs-end', 'left-end', 'right-end', 'total-end', 'mission-desc', 'from', 'to', 'remarks'].forEach(id => {
                    document.getElementById(id).value = '';
                });
                calculateTimes();
            }
            
            alert(editingFlightId ? 'Flight updated successfully!' : 'Flight logged successfully!');
            closeFlightEditor();
            showTab('flights');
        }

        function editFlight(flightId) {
            const flight = flights.find(f => f.id === flightId);
            if (!flight) return;

            editingFlightId = flightId;
            
            // Populate editor with flight data
            const editorContent = `
                <div class="form-group">
                    <label>Aircraft</label>
                    <select id="edit-aircraft">
                        ${Object.keys(aircraft).map(tail => 
                            `<option value="${tail}" ${tail === flight.aircraft ? 'selected' : ''}>${tail}</option>`
                        ).join('')}
                    </select>
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="edit-date" value="${flight.date}">
                </div>
                <div class="form-group">
                    <label>Hobbs Time</label>
                    <div class="form-row">
                        <input type="number" step="0.1" id="edit-hobbs-start" value="${flight.hobbsStart}">
                        <input type="number" step="0.1" id="edit-hobbs-end" value="${flight.hobbsEnd}">
                    </div>
                </div>
                <div class="form-group">
                    <label>Left Tach</label>
                    <div class="form-row">
                        <input type="number" step="0.1" id="edit-left-start" value="${flight.leftStart}">
                        <input type="number" step="0.1" id="edit-left-end" value="${flight.leftEnd}">
                    </div>
                </div>
                <div class="form-group">
                    <label>Right Tach</label>
                    <div class="form-row">
                        <input type="number" step="0.1" id="edit-right-start" value="${flight.rightStart}">
                        <input type="number" step="0.1" id="edit-right-end" value="${flight.rightEnd}">
                    </div>
                </div>
                <div class="form-group">
                    <label>Total Flight Hours</label>
                    <div class="form-row">
                        <input type="number" step="0.1" id="edit-total-start" value="${flight.totalStart}">
                        <input type="number" step="0.1" id="edit-total-end" value="${flight.totalEnd}">
                    </div>
                </div>
                <div class="form-group">
                    <label>Mission Type</label>
                    <input id="edit-mission" value="${flight.mission}">
                </div>
                <div class="form-group">
                    <label>Mission Description</label>
                    <input id="edit-mission-desc" value="${flight.missionDesc}">
                </div>
                <div class="form-group">
                    <div class="form-row">
                        <div>
                            <label>From</label>
                            <input id="edit-from" value="${flight.from}" style="text-transform: uppercase;">
                        </div>
                        <div>
                            <label>To</label>
                            <input id="edit-to" value="${flight.to}" style="text-transform: uppercase;">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Remarks</label>
                    <textarea id="edit-remarks" rows="3">${flight.remarks}</textarea>
                </div>
            `;
            
            document.getElementById('flight-editor-content').innerHTML = editorContent;
            document.getElementById('flight-modal').classList.remove('hidden');
        }

        function saveFlight() {
            if (!editingFlightId) return;

            // Get values from editor
            document.getElementById('flight-date').value = document.getElementById('edit-date').value;
            document.getElementById('hobbs-start').value = document.getElementById('edit-hobbs-start').value;
            document.getElementById('hobbs-end').value = document.getElementById('edit-hobbs-end').value;
            document.getElementById('left-start').value = document.getElementById('edit-left-start').value;
            document.getElementById('left-end').value = document.getElementById('edit-left-end').value;
            document.getElementById('right-start').value = document.getElementById('edit-right-start').value;
            document.getElementById('right-end').value = document.getElementById('edit-
